---
tags:
  - Unity
  - Shader
date: 2025-03-02
---

> [!info] 머리말
> "The Unity Shaders Bible." 이라는 책을 읽고 정리한 내용이다.

---
## 1. 셰이더란 무엇인가?
셰이더는 `.shader` 확장자를 가진 작은 프로그램으로, 게임이나 3d 애플리케이션에 **시각적인 효과**를 나타내는 역할을 수행한다.
셰이더는 화면에 보이는 3d 객체의 각 픽셀 색상을 계산하는 **수학 공식**과 **명령어**로 이루어져 있다. 이를 통해 객체의 위치, 모양, 색상 등을 자유롭게 조작할 수 있다.

셰이더는 **GPU**에서 실행되는데, GPU는 수천 개의 작은 코어로 동시에 많은 작업을 처리할 수 있다.
반면 CPU는 순차적인 직렬 처리를 위해 설계되었기 때문에, 셰이더처럼 대량의 데이터를 다루기에는 적합하지 않다.

유니티에서 셰이더와 관련된 주요 파일은 다음과 같다:
1. `.shader`: 모든 렌더 파이프라인에서 사용할 수 있는 기본 셰이더 파일
2. `.shadergraph`: 코드 없이 노드 기반으로 셰이더를 작성할 수 있는 파일 (URP, HDRP 지원)
3. `.hlsl`: 주로 `.shadergraph`의 커스텀 함수를 제작할 때 사용되는 파일
4. `.cginc`: 재사용 가능한 코드를 모아둔 파일. 대체로 `.shader` 파일에 포함되어 사용된다.

셰이더는 기본적으로 다음 두 단계로 나뉜다:
- **정점 셰이더(Vertex Shader)**: 3d 모델의 정점 위치를 계산
	- 모델을 화면에 맞게 늘리거나, 애니메이션 작업을 할 수 있다.
- **프래그먼트 셰이더(Fragment Shader)**: 각 픽셀의 색상을 결정
	- 조명, 텍스쳐, 그림자 등을 계산하여 최종 색상을 만든다.

유니티는 이런 과정을 쉽게 다룰 수 있도록 도와준다.
특히, **표면 셰이더(Surface Shader)** 라는 도구를 제공하여 조명 계산을 자동으로 처리해준다.

---
## 02. 셰이더 프로그래밍 언어
유니티에서 셰이더를 만들 때 사용하는 주요 언어는 세 가지이다:
1. **HLSL(High Level Shader Language)**
	- Microsoft가 만든 언어로, 현재 유니티의 표준 셰이더 언어
	- `.shader` 파일 내에서, `HLSLPROGRAM` 블록으로 코드를 작성한다.
2. **Cg (C for Graphics)**
	- NVIDIA와 Microsoft가 개발한 언어로, 대부분의 GPU에서 컴파일되도록 설계되었다.
	- 과거에 널리 쓰였으나 최신 기술 지원 부족으로 더 이상 사용되지 않는다.
	- HLSL 및 GLSL과 문법이 비슷하여 전환하기 쉽다.
3. **ShaderLab**
	- 유니티에서 만든 선언적 언어로, 셰이더와 유니티 간의 연결을 담당한다.
	- 셰이더의 속성을 정의해 유니티 인스펙터를 통한 조정을 가능하게 만들어준다.

예를 들어, ShaderLab에서는 속성을 다음과 같이 정의한다:
```c
Properties {
	_Color ("Main Color", Color) = (1, 1, 1, 1)
}
```
이 코드는 유니티 인스펙터에 "Main Color"라는 색상 조정 슬라이더를 추가한다.

ShaderLab의 주요 명령어:
- **Fallback**: 셰이더가 특정 장치에서 작동하지 않을 때를 대비하여, 대체 셰이더를 지정한다.
- **SubShader**: 렌더링 단위를 정의하며, 하나 이상의 **Pass**를 포함한다. 단, URP나 HDRP에서는 단 하나의 **Pass**만을 사용한다.

---
## 03. 유니티 셰이더 유형
*Unity Shader Types*
Built-in RP의 3d template로 유니티 프로젝트를 하나 만들어보자.
우선은 Built-in RP 셰이더를 통해 기초를 다질 것이다.

다음은 유니티에서 제공하는 주요 셰이더 유형이다.

---
### (1) 표준 표면 셰이더
*Standard Surface Shader*
이는 Built-in RP 렌더 파이프라인에서 사용되며, 조명과 상호작용할 수 있는 재질을 쉽게 만든다.

복잡한 조명 계산을 유니티가 대신 처리할 수 있다는 장점이 있다.
(`albedo`, `diffuse`, `specular`를 포함하는 기본 조명 모델을 제공한다는 뜻)

표준 표면 셰이더를 통해 빛이 반사되는 금속 재질 등을 만들 수 있다.

---
### (2) 언릿 셰이더
*Unlit Shader*
> [!TIP] Lit과 Unlit
> Lit은 빛의 영향을 받는 재질을 의미한다.
> Unlit은 그 반대로, 빛의 영향을 받지 않는 재질을 뜻한다.

언릿 셰이더는 조명의 영향을 받지 않기 때문에, UI나 특수 효과(불꽃, 연기 등)에 적합하다.

조명 계산이 없기 때문에 성능이 뛰어나다.
그래서 저사양 장치에서도 잘 작동한다.

모든 렌더 파이프라인에서도 사용할 수 있다는 특징을 갖고 있다.

---
### (3) 이미지 이펙트 셰이더
*Image Effect Shader*
화면 전체에 적용되는 **포스트 프로세싱 효과 (블러, 색상 보정 등)** 를 만든다.
기본적인 구조는 언릿 셰이더와 비슷하다.

이 셰이더를 사용하기 위해서는 `OnRenderImage()` 함수를 사용해야 한다.

```cs
public Material mat;
void OnRenderImage(RenderTexture src, RenderTexture dest)
{
	Graphics.Blit(src, dest, mat);
}
```

---
### (4) 계산 셰이더
*Compute Shader*
렌더링 외의 작업(물리 연산, 다량의 데이터 처리 등)을 GPU에서 처리한다.

이 셰이더의 확장자는 `.compute`이고, HLSL로 작성된다.

수천 개의 입자(`Particles`)를 동시에 움직이는 시뮬레이션을 제작하는 등의 작업에 사용된다.

---
### (5) 레이 트레이싱 셰이더
*Ray Tracing Shader*
빛의 경로를 추적하여 사실적인 조명과 그림자를 구현한다.

이는 HDRP에서만 작동하며, `.raytrace` 확장자를 갖는다.

기본적으로 실험적 프로그램으로, 몇 가지 기술적 제한이 있다:
- DXR(DirectX Raytracing)을 사용하려면 RTX 지원 GRX 1080 이상의 그래픽 카드와 Windwos 10 버전 1809 이상, Unity 2019.3b1 이상이 필요하다.
- 이 셰이더는 `Global Illumination`, `Reflection`, `Refraction`, `Caustics` 등의 레이 캐스팅 알고리즘과 계산 셰이더를 대체하는 데 사용할 수 있다.

---
